(()=>{"use strict";var e={64:function(e,t,i){var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var o=Object.getOwnPropertyDescriptor(t,i);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,o)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),o=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),t.nonce=void 0,t.nonce={},o(i(485),t),o(i(489),t)},485:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,a=arguments.length,r=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(r=(a<3?o(r):a>3?o(t,i,r):o(t,i))||r);return a>3&&r&&Object.defineProperty(t,i,r),r},o=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,a){function r(e){try{l(n.next(e))}catch(e){a(e)}}function s(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,s)}l((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.NewMaCsBot=void 0;const a=i(698),r=i(974),s=i(58),l=i(178),c=i(425),d=i(818),u=i(576);r("msteams");let p=class extends l.DialogBot{constructor(e,t){super(e,t,new c.MainDialog),this._newMaCsMessageExtension=new u.default,this.onMembersAdded(((e,t)=>o(this,void 0,void 0,(function*(){const i=e.activity.membersAdded;if(i&&i.length>0)for(let t=0;t<i.length;t++)i[t].id!==e.activity.recipient.id&&(yield this.sendWelcomeCard(e));yield t()}))))}sendWelcomeCard(e){return o(this,void 0,void 0,(function*(){const t=s.CardFactory.adaptiveCard(d.default);yield e.sendActivity({attachments:[t]})}))}};n([(0,a.MessageExtensionDeclaration)("newMaCsMessageExtension")],p.prototype,"_newMaCsMessageExtension",void 0),p=n([(0,a.BotDeclaration)("/api/messages",new s.MemoryStorage,process.env.MICROSOFT_APP_ID,process.env.MICROSOFT_APP_PASSWORD),(0,a.PreventIframe)("/newMaCsBot/aboutNewMaCs.html")],p),t.NewMaCsBot=p},818:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=i(171);t.default=n},178:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,a){function r(e){try{l(n.next(e))}catch(e){a(e)}}function s(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,s)}l((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.DialogBot=void 0;const o=i(58);class a extends o.TeamsActivityHandler{constructor(e,t,i){super(),this.conversationState=e,this.userState=t,this.dialog=i,this.conversationState=e,this.userState=t,this.dialog=i,this.dialogState=this.conversationState.createProperty("DialogState"),this.onMessage(((e,t)=>n(this,void 0,void 0,(function*(){yield this.dialog.run(e,this.dialogState),yield t()}))))}run(e){const t=Object.create(null,{run:{get:()=>super.run}});return n(this,void 0,void 0,(function*(){yield t.run.call(this,e),yield this.conversationState.saveChanges(e,!1),yield this.userState.saveChanges(e,!1)}))}}t.DialogBot=a},390:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,a){function r(e){try{l(n.next(e))}catch(e){a(e)}}function s(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,s)}l((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.HelloDialog=void 0;const o=i(883),a=i(58),r="helloWaterfallDialog";class s extends o.ComponentDialog{constructor(){super("helloDialog"),this.addDialog(new o.TextPrompt("TextPrompt")).addDialog(new o.WaterfallDialog(r,[this.introStep.bind(this)])),this.initialDialogId=r}run(e,t){return n(this,void 0,void 0,(function*(){const i=new o.DialogSet(t);i.add(this);const n=yield i.createContext(e);(yield n.continueDialog()).status===o.DialogTurnStatus.empty&&(yield n.beginDialog(this.id))}))}introStep(e){return n(this,void 0,void 0,(function*(){const t=a.MessageFactory.text("Hola Mundo!");return yield e.context.sendActivity(t),yield e.endDialog()}))}}t.HelloDialog=s},560:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,a){function r(e){try{l(n.next(e))}catch(e){a(e)}}function s(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,s)}l((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.HelpDialog=void 0;const o=i(883),a=i(58),r="helpWaterfallDialog";class s extends o.ComponentDialog{constructor(){super("helpDialog"),this.addDialog(new o.TextPrompt("TextPrompt")).addDialog(new o.WaterfallDialog(r,[this.introStep.bind(this)])),this.initialDialogId=r}run(e,t){return n(this,void 0,void 0,(function*(){const i=new o.DialogSet(t);i.add(this);const n=yield i.createContext(e);(yield n.continueDialog()).status===o.DialogTurnStatus.empty&&(yield n.beginDialog(this.id))}))}introStep(e){return n(this,void 0,void 0,(function*(){const t=a.MessageFactory.text("I am terribly sorry, but my developer hasn't trained me to do anything yet ðŸ˜‚. Please refer to [this link](https://docs.microsoft.com/en-us/microsoftteams/platform/bots/what-are-bots) to see how to develop bots for Teams");return yield e.context.sendActivity(t),yield e.endDialog()}))}}t.HelpDialog=s},586:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,a){function r(e){try{l(n.next(e))}catch(e){a(e)}}function s(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,s)}l((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.IdDialog=void 0;const o=i(883),a=i(58),r="idWaterfallDialog";class s extends o.ComponentDialog{constructor(){super("idDialog"),this.addDialog(new o.TextPrompt("TextPrompt")).addDialog(new o.WaterfallDialog(r,[this.introStep.bind(this)])),this.initialDialogId=r}run(e,t){return n(this,void 0,void 0,(function*(){const i=new o.DialogSet(t);i.add(this);const n=yield i.createContext(e);(yield n.continueDialog()).status===o.DialogTurnStatus.empty&&(yield n.beginDialog(this.id))}))}introStep(e){return n(this,void 0,void 0,(function*(){const t=a.MessageFactory.text("Bienvenidos, esto es I+D! Proyecto INTERACTIVO 1.0");return yield e.context.sendActivity(t),yield e.endDialog()}))}}t.IdDialog=s},425:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,a){function r(e){try{l(n.next(e))}catch(e){a(e)}}function s(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,s)}l((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.MainDialog=void 0;const o=i(883),a=i(58),r=i(829),s=i(560),l=i(486),c=i(390),d=i(586),u="mainWaterfallDialog";class p extends o.ComponentDialog{constructor(){super("mainDialog"),this.addDialog(new o.TextPrompt("TextPrompt")).addDialog(new r.TeamsInfoDialog).addDialog(new s.HelpDialog).addDialog(new c.HelloDialog).addDialog(new d.IdDialog).addDialog(new l.MentionUserDialog).addDialog(new o.WaterfallDialog(u,[this.introStep.bind(this),this.actStep.bind(this),this.finalStep.bind(this)])),this.initialDialogId=u,this.onboarding=!1}run(e,t){return n(this,void 0,void 0,(function*(){const i=new o.DialogSet(t);i.add(this);const n=yield i.createContext(e);(yield n.continueDialog()).status===o.DialogTurnStatus.empty&&(yield n.beginDialog(this.id))}))}introStep(e){return n(this,void 0,void 0,(function*(){if(e.options.restartMsg){const t=e.options.restartMsg?e.options.restartMsg:"Hola! Â¿En que te puedo ayudar hoy? Para mas informacion escribe: 'ayuda'",i=a.MessageFactory.text(t,t,a.InputHints.ExpectingInput);return yield e.prompt("TextPrompt",{prompt:i})}return this.onboarding=!0,yield e.next()}))}actStep(e){return n(this,void 0,void 0,(function*(){if(e.result)switch(e.result.trim().toLocaleLowerCase()){case"who":case"who am i?":return yield e.beginDialog("teamsInfoDialog");case"hello world":case"hello":return yield e.beginDialog("helloDialog");case"id team":case"id":return yield e.beginDialog("idDialog");case"get help":case"help":return yield e.beginDialog("helpDialog");case"mention me":case"mention":return yield e.beginDialog("mentionUserDialog");default:return yield e.context.sendActivity("No te he entendido... Â¿Puedes repetirlo por favor?"),yield e.next()}else if(this.onboarding)switch(e.context.activity.text){case"who":return yield e.beginDialog("teamsInfoDialog");case"hello":return yield e.beginDialog("helloDialog");case"id":return yield e.beginDialog("idDialog");case"help":return yield e.beginDialog("helpDialog");case"mention":return yield e.beginDialog("mentionUserDialog");default:return yield e.context.sendActivity("No te he entendido... Â¿Puedes repetirlo por favor?"),yield e.next()}return yield e.next()}))}finalStep(e){return n(this,void 0,void 0,(function*(){return yield e.replaceDialog(this.initialDialogId,{restartMsg:"Â¿En que te puedo ayudar hoy? Escribe 'info' para mas informacion"})}))}}t.MainDialog=p},486:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,a){function r(e){try{l(n.next(e))}catch(e){a(e)}}function s(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,s)}l((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.MentionUserDialog=void 0;const o=i(883),a=i(58),r="mentionUserWaterfallDialog";class s extends o.ComponentDialog{constructor(){super("mentionUserDialog"),this.addDialog(new o.TextPrompt("TextPrompt")).addDialog(new o.WaterfallDialog(r,[this.introStep.bind(this)])),this.initialDialogId=r}run(e,t){return n(this,void 0,void 0,(function*(){const i=new o.DialogSet(t);i.add(this);const n=yield i.createContext(e);(yield n.continueDialog()).status===o.DialogTurnStatus.empty&&(yield n.beginDialog(this.id))}))}introStep(e){return n(this,void 0,void 0,(function*(){const t={mentioned:e.context.activity.from,text:`<at>${(new TextEncoder).encode(e.context.activity.from.name)}</at>`,type:"mention"},i=a.MessageFactory.text(`Hola ${t.text}!`);return i.entities=[t],yield e.context.sendActivity(i),yield e.endDialog()}))}}t.MentionUserDialog=s},829:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,a){function r(e){try{l(n.next(e))}catch(e){a(e)}}function s(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,s)}l((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.TeamsInfoDialog=void 0;const o=i(883),a=i(58),r="teamsInfoWaterfallDialog";let s;class l extends o.ComponentDialog{constructor(){super("teamsInfoDialog"),this.addDialog(new o.TextPrompt("TextPrompt")).addDialog(new o.WaterfallDialog(r,[this.introStep.bind(this),this.actStep.bind(this),this.finalStep.bind(this)])),this.initialDialogId=r}run(e,t){return n(this,void 0,void 0,(function*(){const i=new o.DialogSet(t);i.add(this);const n=yield i.createContext(e);(yield n.continueDialog()).status===o.DialogTurnStatus.empty&&(yield n.beginDialog(this.id))}))}introStep(e){return n(this,void 0,void 0,(function*(){const t=a.MessageFactory.text("Do you want me to send you the current Teams member info?\n\nSay **yes** if you do like to see the context or **no** if you don't");return yield e.prompt("TextPrompt",{prompt:t})}))}actStep(e){return n(this,void 0,void 0,(function*(){if(e.result){if("yes"!==e.result)return yield e.context.sendActivity("No te he entendido... Â¿Puedes repetirlo por favor?"),yield e.next();s=yield a.TeamsInfo.getMember(e.context,e.context.activity.from.id),yield e.context.sendActivity(`Tu NOMBRE es: **${s.name}**\n\nTu ID de TEAMS: **${s.id}**\n\nTu EMAIL: **${s.email}**`)}return yield e.next()}))}finalStep(e){return n(this,void 0,void 0,(function*(){return yield e.context.sendActivity("Now it's time to add more functionality to your bot, so head over to the [docs](https://aka.ms/yoTeams) and start building"),yield e.endDialog()}))}}t.TeamsInfoDialog=l},576:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,a=arguments.length,r=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(r=(a<3?o(r):a>3?o(t,i,r):o(t,i))||r);return a>3&&r&&Object.defineProperty(t,i,r),r},o=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,a){function r(e){try{l(n.next(e))}catch(e){a(e)}}function s(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,s)}l((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const a=i(974),r=i(698),s=i(58),l=a("msteams");let c=class{onQuery(e,t){return o(this,void 0,void 0,(function*(){const e=s.CardFactory.adaptiveCard({type:"AdaptiveCard",body:[{type:"TextBlock",size:"Large",text:"Headline"},{type:"TextBlock",text:"Description"},{type:"Image",url:`https://${process.env.PUBLIC_HOSTNAME}/assets/icon.png`},{type:"ActionSet",actions:[{type:"Action.Execute",title:"More details",data:{action:"moreDetails",id:"1234-5678"},fallback:"Action.Submit"}]}],$schema:"http://adaptivecards.io/schemas/adaptive-card.json",version:"1.4"}),i={contentType:"application/vnd.microsoft.card.thumbnail",content:{title:"Headline",text:"Description",images:[{url:`https://${process.env.PUBLIC_HOSTNAME}/assets/icon.png`}]}};return t.parameters&&t.parameters[0]&&t.parameters[0].name,Promise.resolve({type:"result",attachmentLayout:"list",attachments:[Object.assign(Object.assign({},e),{preview:i})]})}))}onCardButtonClicked(e,t){return o(this,void 0,void 0,(function*(){return"moreDetails"===t.action&&l(`I got this ${t.id}`),Promise.resolve()}))}onQuerySettingsUrl(e){return o(this,void 0,void 0,(function*(){return Promise.resolve({title:"NewMaCS Message Extension Configuration",value:`https://${process.env.PUBLIC_HOSTNAME}/newMaCsMessageExtension/config.html?name={loginHint}&tenant={tid}&group={groupId}&theme={theme}`})}))}onSettings(e){return o(this,void 0,void 0,(function*(){const t=e.activity.value.state;return l(`New setting: ${t}`),Promise.resolve()}))}};c=n([(0,r.PreventIframe)("/newMaCsMessageExtension/config.html")],c),t.default=c},489:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,a=arguments.length,r=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(r=(a<3?o(r):a>3?o(t,i,r):o(t,i))||r);return a>3&&r&&Object.defineProperty(t,i,r),r};Object.defineProperty(t,"__esModule",{value:!0}),t.NewMaCsOutgoingWebhook=void 0;const o=i(58),a=i(113),r=i(698);let s=class{requestHandler(e,t,i){const n=e.body,r={type:o.ActivityTypes.Message},s=process.env.SECURITY_TOKEN;if(s&&s.length>0){const t=e.headers.authorization,i=Buffer.from(e.rawBody,"utf8"),o="HMAC "+a.createHmac("sha256",Buffer.from(s,"base64")).update(i).digest("base64");r.text=o===t?`Echo ${n.text}`:"Error: message sender cannot be verified"}else r.text="Error: outgoing webhook is not configured with a security token";t.send(JSON.stringify(r))}};s=n([(0,r.OutgoingWebhookDeclaration)("/api/webhook")],s),t.NewMaCsOutgoingWebhook=s},58:e=>{e.exports=require("botbuilder")},883:e=>{e.exports=require("botbuilder-dialogs")},455:e=>{e.exports=require("compression")},974:e=>{e.exports=require("debug")},142:e=>{e.exports=require("dotenv")},860:e=>{e.exports=require("express")},698:e=>{e.exports=require("express-msteams-host")},470:e=>{e.exports=require("morgan")},113:e=>{e.exports=require("crypto")},685:e=>{e.exports=require("http")},17:e=>{e.exports=require("path")},171:e=>{e.exports=JSON.parse('{"$schema":"http://adaptivecards.io/schemas/adaptive-card.json","type":"AdaptiveCard","version":"1.4","body":[{"type":"ColumnSet","columns":[{"type":"Column","width":"auto","items":[{"type":"Image","url":"https://raw.githubusercontent.com/pnp/media/master/parker/teams/300w/parker-teams-300.png","size":"Medium"}],"verticalContentAlignment":"Center","spacing":"Large"},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","spacing":"Medium","size":"Large","weight":"Bolder","text":"Bienvenido a NewMaCS","wrap":true,"maxLines":0},{"type":"TextBlock","size":"default","text":"Hola! Un gusto conocerte, esta es la plataforma de New.Ma.C.S. La cual te ayudara en tu dÃ­a a dÃ­a","wrap":true,"maxLines":0}]}]},{"type":"ActionSet","actions":[{"type":"Action.OpenUrl","title":"Learn more about Yo Teams","url":"https://aka.ms/yoteams"},{"type":"Action.OpenUrl","title":"Learn more about bots in Teams","url":"https://docs.microsoft.com/en-us/microsoftteams/platform/bots/what-are-bots"}],"height":"stretch","horizontalAlignment":"Center"},{"type":"ActionSet","actions":[{"type":"Action.Submit","title":"Who am I?","data":{"msteams":{"type":"messageBack","displayText":"who am i?","text":"who"}}},{"type":"Action.Submit","title":"Mention me","data":{"msteams":{"type":"messageBack","displayText":"mention me","text":"mention"}}},{"type":"Action.Submit","title":"Get help","data":{"msteams":{"type":"messageBack","displayText":"get help","text":"help"}}},{"type":"Action.Submit","title":"Hello world","data":{"msteams":{"type":"messageBack","displayText":"hello world","text":"hello"}}},{"type":"Action.Submit","title":"Id team","data":{"msteams":{"type":"messageBack","displayText":"id team","text":"id"}}}]}]}')}},t={};function i(n){var o=t[n];if(void 0!==o)return o.exports;var a=t[n]={exports:{}};return e[n].call(a.exports,a,a.exports,i),a.exports}(()=>{const e=i(860),t=i(685),n=i(17),o=i(470),a=i(698),r=i(974),s=i(455),l=r("msteams");l("Initializing Microsoft Teams Express hosted App..."),i(142).config();const c=i(64),d=e(),u=process.env.port||process.env.PORT||3007;d.use(e.json({verify:(e,t,i,n)=>{e.rawBody=i.toString()}})),d.use(e.urlencoded({extended:!0})),d.set("views",n.join(__dirname,"/")),d.use(o("tiny")),d.use(s()),d.use("/scripts",e.static(n.join(__dirname,"web/scripts"))),d.use("/assets",e.static(n.join(__dirname,"web/assets"))),d.use((0,a.MsTeamsApiRouter)(c)),d.use((0,a.MsTeamsPageRouter)({root:n.join(__dirname,"web/"),components:c})),d.use("/",e.static(n.join(__dirname,"web/"),{index:"index.html"})),d.set("port",u),t.createServer(d).listen(u,(()=>{l(`Server running on ${u}`)}))})()})();
//# sourceMappingURL=server.js.map